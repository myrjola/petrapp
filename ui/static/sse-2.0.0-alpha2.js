// BSD 2-Clause License | Copyright (c) 2020, Big Sky Software All rights reserved.
!function(){var e;function t(e){return new EventSource(e,{withCredentials:!0})}htmx.defineExtension("sse",{init:function(n){e=n,void 0==htmx.createEventSource&&(htmx.createEventSource=t)},onEvent:function(t,a){var o=a.target||a.detail.elt;switch(t){case"htmx:beforeCleanupElement":var u=e.getInternalData(o);u.sseEventSource&&u.sseEventSource.close();return;case"htmx:afterProcessNode":(function t(a,o){var u;if(null==a)return null;r(a,"sse-connect").forEach(function(r){var s,a,i,u,c=e.getAttributeValue(r,"sse-connect");if(null!=c){s=r,a=c,i=o,u=htmx.createEventSource(a),u.onerror=function(r){if(e.triggerErrorEvent(s,"htmx:sseError",{error:r,source:u}),!n(s)&&u.readyState===EventSource.CLOSED){var a=Math.random()*(2^(i=i||0))*500;window.setTimeout(function(){t(s,Math.min(7,i+1))},a)}},u.onopen=function(t){e.triggerEvent(s,"htmx:sseOpen",{source:u})},e.getInternalData(s).sseEventSource=u}}),r(u=a,"sse-swap").forEach(function(t){var r=e.getClosestMatch(t,i);if(null==r)return null;for(var a=e.getInternalData(r).sseEventSource,o=e.getAttributeValue(t,"sse-swap").split(","),c=0;c<o.length;c++){var l=o[c].trim(),f=function(i){if(!n(r)){if(!e.bodyContains(t)){a.removeEventListener(l,f);return}e.triggerEvent(u,"htmx:sseBeforeMessage",i)&&(s(t,i.data),e.triggerEvent(u,"htmx:sseMessage",i))}};e.getInternalData(t).sseEventListener=f,a.addEventListener(l,f)}}),r(u,"hx-trigger").forEach(function(t){var r=e.getClosestMatch(t,i);if(null==r)return null;var s=e.getInternalData(r).sseEventSource,a=e.getAttributeValue(t,"hx-trigger");if(null!=a&&"sse:"==a.slice(0,4)){var o=function(i){!n(r)&&(e.bodyContains(t)||s.removeEventListener(a,o),htmx.trigger(t,a,i),htmx.trigger(t,"htmx:sseMessage",i))};e.getInternalData(u).sseEventListener=o,s.addEventListener(a.slice(4),o)}})})(o)}}});function n(t){if(!e.bodyContains(t)){var n=e.getInternalData(t).sseEventSource;if(void 0!=n)return n.close(),!0}return!1}function r(t,n){var r=[];return e.hasAttribute(t,n)&&r.push(t),t.querySelectorAll("["+n+"], [data-"+n+"]").forEach(function(e){r.push(e)}),r}function s(t,n){e.withExtensions(t,function(e){n=e.transformResponse(n,null,t)});var r=e.getSwapSpecification(t),s=e.getTarget(t);e.swap(s,n,r)}function a(t){return function(){t.tasks.forEach(function(e){e.call()}),t.elts.forEach(function(t){t.classList&&t.classList.remove(htmx.config.settlingClass),e.triggerEvent(t,"htmx:afterSettle")})}}function i(t){return null!=e.getInternalData(t).sseEventSource}}();
