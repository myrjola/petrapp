// BSD 2-Clause License | Copyright (c) 2020, Big Sky Software All rights reserved.
!function(){var e;function t(e){return new EventSource(e,{withCredentials:!0})}function n(e){return e.trim().split(/\s+/)}function r(t,o){if(null==t)return null;var u=e.getInternalData(t),c=e.getAttributeValue(t,"sse-connect");if(null==c){var l=function(t){var r=e.getAttributeValue(t,"hx-sse");if(r)for(var s=n(r),a=0;a<s.length;a++){var i=s[a].split(/:(.+)/);if("connect"===i[0])return i[1]}}(t);if(!l)return null;c=l}var f=htmx.createEventSource(c);u.sseEventSource=f,f.onerror=function(n){if(e.triggerErrorEvent(t,"htmx:sseError",{error:n,source:f}),!s(t)&&f.readyState===EventSource.CLOSED){o=o||0;var a=Math.random()*(2^o)*500;window.setTimeout((function(){r(t,Math.min(7,o+1))}),a)}},f.onopen=function(n){e.triggerEvent(t,"htmx:sseOpen",{source:f})},a(t,"sse-swap").forEach((function(r){var a=e.getAttributeValue(r,"sse-swap");if(a)var o=a.split(",");else o=function(t){var r=e.getAttributeValue(t,"hx-sse"),s=[];if(r)for(var a=n(r),i=0;i<a.length;i++){var o=a[i].split(/:(.+)/);"swap"===o[0]&&s.push(o[1])}return s}(r);for(var u=0;u<o.length;u++){var c=o[u].trim(),l=function(n){s(t)?f.removeEventListener(c,l):(i(r,n.data),e.triggerEvent(t,"htmx:sseMessage",n))};e.getInternalData(t).sseEventListener=l,f.addEventListener(c,l)}})),a(t,"hx-trigger").forEach((function(n){var r=e.getAttributeValue(n,"hx-trigger");if(null!=r&&"sse:"==r.slice(0,4)){var a=function(e){s(t)?f.removeEventListener(r,a):(htmx.trigger(n,r,e),htmx.trigger(n,"htmx:sseMessage",e))};e.getInternalData(t).sseEventListener=a,f.addEventListener(r.slice(4),a)}}))}function s(t){if(!e.bodyContains(t)){var n=e.getInternalData(t).sseEventSource;if(null!=n)return n.close(),!0}return!1}function a(t,n){var r=[];return(e.hasAttribute(t,n)||e.hasAttribute(t,"hx-sse"))&&r.push(t),t.querySelectorAll("["+n+"], [data-"+n+"], [hx-sse], [data-hx-sse]").forEach((function(e){r.push(e)})),r}function i(t,n){e.withExtensions(t,(function(e){n=e.transformResponse(n,null,t)}));var r=e.getSwapSpecification(t),s=e.getTarget(t),a=e.makeSettleInfo(t);e.selectAndSwap(r.swapStyle,s,t,n,a),a.elts.forEach((function(t){t.classList&&t.classList.add(htmx.config.settlingClass),e.triggerEvent(t,"htmx:beforeSettle")})),r.settleDelay>0?setTimeout(o(a),r.settleDelay):o(a)()}function o(t){return function(){t.tasks.forEach((function(e){e.call()})),t.elts.forEach((function(t){t.classList&&t.classList.remove(htmx.config.settlingClass),e.triggerEvent(t,"htmx:afterSettle")}))}}htmx.defineExtension("sse",{init:function(n){e=n,null==htmx.createEventSource&&(htmx.createEventSource=t)},onEvent:function(t,n){switch(t){case"htmx:beforeCleanupElement":var s=e.getInternalData(n.target);return void(s.sseEventSource&&s.sseEventSource.close());case"htmx:afterProcessNode":r(n.target)}}})}();
